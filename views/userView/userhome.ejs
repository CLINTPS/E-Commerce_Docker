<%-include('../userView/include/user_header')-%>
<div class="bg-light">
    <div>
        <div class="text-center">
            <div class="dashbrd"  style="width: 100%; background-color: rgb(181, 211, 174)">
                <!-- <a href="" class="btn btn-warning" style="position: absolute; margin-top: 35%; left:12%">Buy Now</a>
                <a href="" class="btn btn-light" style="position: absolute; margin-top: 35%; left:20%">Add To Cart</a> -->
                <img src="/images/first.webp" class="d-block w-100" alt="">
                <h1 class="text-black pt-4 ">Discover NEW Arrivals</h1>
                <P>Recently added Mobiles!</P>
                         
                <div class="row" style="margin:0%;">
                    <% if (Array.isArray(productData)) { %>
                    <% productData.forEach((product)=>{ %>
                        <% if(product.AvailableQuantity > 0 && product.Status===true){%>
                    <div class="col-md-3 p-4">
                        <div class="card" style="width: 18rem; margin-left: 20px;">
                            <img class="card-img-top" style="height: 290px; width: 250px; padding: 20px; margin-left: 20px;" src="/product-img/<%= product.images[0] %>" alt="Card image cap">
                            <div class="card-body">
                                <h6 class="card-title"><%=product.ProductName%></h6>
                                <p class="card-title"><%=product.BrandName%></p>
                                <p class="card-text" style="font-weight: 700;">â‚¹<%=product.Price%>/-</p>
                                <button class="btn btn-warning add-to-cart-button"
                                    data-product-id="<%= product._id %>">Add To Cart</button>
                                <a href="/productDetails/<%=product._id%>" class="btn btn-primary">view Details</a>
                            </div>
                        </div>     
                    </div>
                    <% } %>     
                    <%}) %>
                    <% } %>
                </div>
                <a href="/allProducts">View All</a> 
            </div>            
        </div>
    </div>
</div>
<%-include('../userView/include/user_footer')-%>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="your-script.js"></script>

<script>




    function updateCartQuantity() {

        $.ajax({
            url: '/getcartquantity',
            method: 'GET',
            success: function (response) {
                const cartQuantityElement = document.getElementById('cart-quantity');
                cartQuantityElement.textContent = response.quantity;
            },
            error: function (error) {
                console.error('Error fetching cart quantity:', error);
            }
        });
    }




    document.querySelectorAll('.add-to-cart-button').forEach(button => {
        button.addEventListener('click', function (event) {
            event.preventDefault();

            const productId = this.getAttribute('data-product-id');
            console.log(productId);

            $.ajax({
                url: '/addtocart/' + productId,
                method: 'POST',
                success: function (response) {

                    alert('Product added to cart');
                    updateCartQuantity();
                    location.reload()
                },
                error: function (error) {
                    console.error('Error adding product to cart:', error);
                }
            });
        });
    });


    document.querySelectorAll('.add-to-wishlist-button').forEach(button => {
        button.addEventListener('click', function (event) {
            event.preventDefault();


            const productId = this.getAttribute('data-product-id');
            const icon = this.querySelector('.fa-heart');

            $.ajax({
                url: '/wishlist/',
                method: 'POST',
                data: {
                    productId: productId,
                },
                success: function (response) {
                    console.log(icon.style.color)
                    if (response.added) {
                        // icon.style.color = 'red';
                        icon.classList.add('text-danger')
                        //   location.reload()
                    } else {

                        // icon.style.color = '';
                        icon.classList.remove('text-danger')
                        //   location.reload()
                    }
                },
                error: function (error) {
                    console.error('Error updating wishlist:', error);
                }
            });
        });
    });

</script>